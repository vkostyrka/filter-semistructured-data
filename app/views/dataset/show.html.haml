%button.btn.btn-primary{"data-target" => "#create-filter-modal", "data-toggle" => "modal"}
  Create filter
%br/
= label_tag 'Choose filter'
= select_tag("Choose_filter", options_for_select(['No filter'] + @filters.collect{ |f| [f.filter_name, f.id] }), onchange: "applyFilter(this.value, #{@dataset.id})")
#create-filter-modal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "create-filter-modal", :role => "dialog", :tabindex => "-1"}
  .modal-dialog
    .modal-content
      .modal-header
        %h5.modal-title Create new filter
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal"}
          %span{"aria-hidden" => "true"} Ã—
      = form_with model: Filter.new, url: filter_index_path do |f|
        .modal-body
          .row
            .col-4
              = f.label :column_name
              %br/
              = f.label :condition
              %br/
              = f.label :value
            .col-8
              = f.select :column_name, options_for_select(@headers)
              %br/
              = f.select :condition, options_for_select(Filter.conditions.keys.map { |item| item.tr('_', ' ') })
              %br/
              = f.text_field :value
              = f.hidden_field :dataset_id, value: @dataset.id

        .modal-footer
          = f.submit("Create", class: "btn-primary btn")

%table#data-table
  %thead
    %tr
      - @headers.each do |header|
        %th.text-truncate #{header}
  %tbody
    - @data.each do |row|
      %tr
        - row.each do |item|
          %td #{item}
:javascript
  $('#data-table').DataTable( {
    "pagingType": "full_numbers"
  } );

  function applyFilter(value, datasetId) {
    if (value === 'No filter') {
      window.location.href = `/dataset/${datasetId}`
    } else {
      window.location.href = `/dataset/${datasetId}?filter=${value}`
    }
  }
